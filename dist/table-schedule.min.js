/**
 * TableSchedule.js v0.1.0 by Monkey-D-Pixel
 * git@github.com:Monkey-D-Pixel/table-schedule.git
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).TableSchedule=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e,n,r,s,a,i,o,l=function e(n){if(!n||!n.tagName)return null;var r=document.createElement(n.tagName);if(n.attr&&Object.keys(n.attr).length)for(var s in n.attr)null!==n.attr[s]&&void 0!==n.attr[s]&&r.setAttribute(s,String(n.attr[s]));n.id&&"string"==typeof n.id&&(r.id=n.id),n.className&&"string"==typeof n.className&&(r.className=n.className),n.style&&"object"===t(n.style)&&Object.keys(n.style).length&&Object.assign(r.style,n.style);var a=n.children;if(a&&a instanceof Array&&a.length)for(var i=0;i<a.length;i++){var o=e(a[i]);o&&r.appendChild(o)}else null!=a&&(n.html?r.innerHTML=String(a):r.innerText=String(a));return r},h=function(t){return t<10?"0"+t:t.toString()},d=function(t){return t.getFullYear()+"/"+h(t.getMonth()+1)+"/"+h(t.getDate())},c=function(t){t=(t||"").replace(/-/g,"/");var e=Date.parse(t);return new Date(e)},u=function(t){var e=parseInt(t/60),n=parseInt(t%60);return e<10&&(e="0"+e),n<10&&(n="0"+n),e+":"+n},v=function(t){var e=(t=t||"").split(":"),n=parseInt(e[0]),r=parseInt(e[1]);return isNaN(n)||isNaN(r)?0:60*n+r},f=function(t,e){for(var n=t.parentElement;n&&!n.matches(e);)n=n.parentElement;return n},p=function(t,e){for(var n=t.target;n&&!n.matches(e);){if(n===t.currentTarget){n=null;break}n=n.parentElement}return n},m=/(auto|scroll)/,g=function(t,e){return getComputedStyle(t,null).getPropertyValue(e)},y=function(t){return m.test(function(t){return g(t,"overflow")+g(t,"overflow-y")+g(t,"overflow-x")}(t))},_=function(t){for(var e=t.parentElement;e&&!y(e);)e=e.parentElement;return e||document.scrollingElement||document.documentElement},E=function(t){return t.getBoundingClientRect()},x=function(t,e){e=e||document.scrollingElement||document.documentElement;var n=t.getBoundingClientRect().toJSON();return n.top+=e.scrollTop,n.bottom+=e.scrollTop,n.left+=e.scrollLeft,n.right+=e.scrollLeft,n},b=function(t,e){e=e||t.parentElement;var n=E(t),r=E(e);return{top:n.top-r.top,left:n.left-r.left,width:n.width,height:n.height}},C=function(t,e,n){var r;return"function"==typeof Event&&"function"==typeof CustomEvent?r=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0}):(r=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,n),t.dispatchEvent(r)},T=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},N=function(t,e){if(!Array.isArray(t)||!t.length)return!1;var n=[];Array.isArray(e)?n=e:n.push(e);for(var r=0;r<n.length;r++)if(t.indexOf(n[r])>-1)return!0;return!1},D={startDate:new Date,num:7,dayStart:6,dayEnd:22,gap:10,quantizing:!0,createThreshold:10,stretchThreshold:5,moveYThreshold:5,dateFormat:function(t){return d(t).substring(5)},directChange:!1,extraDataset:null},I="create",L="modify",S="remove",w={_genDates:function(t){this.dates=[];for(var e=new Date(this.config.startDate),n=0;n<this.config.num;n++)this.dates.push(new Date(e)),t||(this.events.push([]),this._events.push([])),e.setDate(e.getDate()+1)},_genThead:function(){for(var t=this.config,e=this.dates,n={tagName:"THEAD",props:{},children:[{tagName:"TR",props:{},children:[{tagName:"TH",props:{}}]}]},r=0;r<e.length;r++)n.children[0].children.push({tagName:"TH",props:{},html:!0,children:t.dateFormat(e[r])});return n},_renderOuter:function(){var t=this.config,e=this.dates,n=this._genThead(),r={tagName:"TABLE",className:"time-line",children:[{tagName:"TBODY",children:[]}]},s=new Date;s.setHours(t.dayStart,0,0,0);for(var a,i=Math.ceil(60*(t.dayEnd-t.dayStart)/t.gap),o=0;o<i;o++)r.children[0].children.push({tagName:"TR",children:[{tagName:"TH",children:[{tagName:"div",children:(a=s,h(a.getHours())+":"+h(a.getMinutes()))}]}]}),s.setMinutes(s.getMinutes()+t.gap);for(var d={tagName:"TBODY",children:[{tagName:"TR",children:[{tagName:"TD",className:"time-line-wrapper",children:[r]}]}]},c=0;c<e.length;c++)d.children[0].children.push({tagName:"TD",className:"day-col"});this.el.root.appendChild(l(n)),this.el.root.appendChild(l(d))},_setGrid:function(t,e){e=e||1;for(var n=this.config,r=Math.ceil(60*(n.dayEnd-n.dayStart)/n.gap),s=this.el.dayGrids[t].firstElementChild,a={tagName:"TR",children:[]},i=0;i<e;i++)a.children.push({tagName:"TD",className:"grid-cell"});s.innerHTML="";for(var o=0;o<r;o++)s.appendChild(l(a))},_renderInner:function(t){var e=this.el.dayCols,n={tagName:"DIV",className:"events-container",attr:{"data-index":0},children:[{tagName:"DIV",className:"events-col"}]},r={tagName:"TABLE",className:"day-grid",children:[{tagName:"TBODY",children:[]}]};if("number"==typeof t&&e[t])e[t].innerHTML="",e[t].appendChild(l(r)),this._setGrid(t),n.attr["data-index"]=t,e[t].appendChild(l(n));else for(var s=0;s<e.length;s++)e[s].innerHTML="",e[s].appendChild(l(r)),this._setGrid(s),n.attr["data-index"]=s,e[s].appendChild(l(n))},_renderEvent:function(e){var n=this.config,r=e.dateIndex,s=(e.startm-60*n.dayStart)/n.gap*20,a=(e.endm-e.startm)/n.gap*20,i=e.style&&"object"===t(e.style)?e.style:{},o=e.className?String(e.className).trim():"",h={"data-startm":e.startm,"data-endm":e.endm,"data-nr":e.nr};if(n.extraDataset&&Object.keys(n.extraDataset).length)for(var d in n.extraDataset)!T(h,"data-"+d)&&T(e,n.extraDataset[d])&&(h["data-"+d]=e[n.extraDataset[d]]);var c=l({tagName:"DIV",className:"event"+(o?" "+o:""),style:Object.assign({},i,{top:s+"px",height:a+"px"}),attr:h,children:[{tagName:"DIV",className:"event-content-wrapper",children:[{tagName:"DIV",className:"event-title",children:e.title||""},{tagName:"DIV",className:"event-content",children:e.content,html:!0}]},{tagName:"DIV",className:"event-bar-wrapper",children:[{tagName:"SPAN",className:"event-bar"}]}]});this._insertIntoDate(c,r)},_insertIntoDate:function(t,e){for(var n=this.el.eventsContainers[e].children,r=!1,s=t.dataset.nr,a=this.events[e][s],i=0;i<n.length&&!(r=this._insertIntoCol(t,n[i]));i++);if(!r){var o=this._addCol(e,a.group);this._insertIntoCol(t,n[o])}},_arrangeEvents:function(t){for(var e=this.el.eventsContainers[t],n=e.children,r=0;r<n.length;r++)0===n[r].childElementCount&&(0===r?n[r].removeAttribute("data-group"):(e.removeChild(n[r]),r-=1));if(n.length>1){for(var s=1;s<n.length;s++)for(var a=n[s].children,i=0;i<a.length;i++){for(var o=!1,l=0;!o&&l<s;)o=this._insertIntoCol(a[i],n[l]),l+=1;o&&(i-=1)}if(n.length>1)for(var h=0;h<n.length;h++)0===n[h].childElementCount&&(e.removeChild(n[h]),h-=1)}this._setGrid(t,n.length)},_addCol:function(t,e){var n=l({tagName:"DIV",className:"events-col"}),r=-1,s=this.el.eventsContainers[t];if(void 0!==e){e=String(e),n.dataset.group=e;var a=s.querySelectorAll('[data-group="'+e+'"]');a.length?(a[a.length-1].insertAdjacentElement("afterEnd",n),r=[].indexOf.call(s.children,n)):(s.appendChild(n),r=s.children.length-1)}else s.appendChild(n),r=s.children.length-1;return this._setGrid(t,s.children.length),r},_insertIntoCol:function(t,e){var n=t.dataset.nr,r=e.parentElement.dataset.index,s=this._events[r][n],a=s.group;void 0!==a&&(a=String(a));var i=s.startm,o=s.endm,l=e.children;if(l.length){if(e.dataset.group!==a)return!1;for(var h=!0,d=0;d<l.length;d++)if(l[d]!==t){var c=this._posToMinute(l[d]);if(!(c.startm>=o||c.endm<=i)){h=!1;break}}return!!h&&(e.appendChild(t),!0)}return void 0!==a&&(e.dataset.group=String(a)),e.appendChild(t),!0},_clearDom:function(t){var e=this;this._toDateIndexList(t).forEach((function(t){for(var n=e.el.eventsContainers[t].getElementsByClassName("event"),r=0;r<n.length;r++)n[r].parentElement.removeChild(n[r]),r-=1;e._renderInner(t)}))}},M={addEvent:function(t){var e=this._tsItem(t);if(e){for(var n=0,r=this._events[e.dateIndex],s=this.events[e.dateIndex];n<r.length&&r[n].startm<=e.startm;)n+=1;for(e.nr=n,n=r.length-1;n>=e.nr;)this.el.dayCols[e.dateIndex].querySelector('[data-nr="'+r[n].nr+'"]').dataset.nr=r[n].nr+1,r[n].nr+=1,n-=1;r.splice(e.nr,0,e),s.splice(e.nr,0,t),this._renderEvent(e)}return this},updateEvent:function(t,e){var n=this.config,r=Array.isArray(t)&&t.length>=2&&t[0]>=0&&t[0]<n.num&&t[1]>=0&&t[1]<this.events[t[0]].length,s=this._tsItem(e);if(r&&s){var a=t[0],i=t[1];if(s.dateIndex!==a)this.deleteEvent(t),this.addEvent(e),this._arrangeEvents(s.dateIndex);else{s.nr=i,this.events[a][i]=e,this._events[a][i]=s;var o=this.el.eventsContainers[a].querySelector('[data-nr="'+i+'"]'),l=this._minuteToTop(s.startm);o&&l>=0&&(Object.assign(o.style,{top:l+"px",height:this._minuteToTop(s.endm)-l+"px"}),this._insertIntoDate(o,a),this._arrangeEvents(a))}}return this},deleteEvent:function(t){var e=this.config;if(Array.isArray(t)&&t.length>=2&&t[0]>=0&&t[0]<e.num&&t[1]>=0&&t[1]<this.events[t[0]].length){var n=t[0],r=t[1],s=this._events[n],a=this.events[n];s.splice(r,1),a.splice(r,1);var i=this.el.dayCols[n].querySelector('[data-nr="'+r+'"]');i.parentElement.removeChild(i);for(var o=r;o<s.length;)this.el.dayCols[n].querySelector('[data-nr="'+s[o].nr+'"]').dataset.nr=s[o].nr-1,s[o].nr-=1,o+=1;this._arrangeEvents(n)}return this},clear:function(t){var e=this;return this._clearDom(t),this._toDateIndexList(t).forEach((function(t){e.events[t]=[],e._events[t]=[]})),this},rerender:function(){var t=this,e=this.config;this._clearDom();for(var n=0;n<e.num;n++)this._events[n].forEach((function(e){t._renderEvent(e)})),this._arrangeEvents(n);return this},changeStartDate:function(t){var e=this,n=this.config;return t instanceof Date&&"Invalid Date"!==t.toString()&&function(){var r=new Date(t),s=new Date(n.startDate);r.setHours(0,0,0,0),s.setHours(0,0,0,0);var a=(r.getTime()-s.getTime())/1e3/60/60/24,i=e.el.root.querySelector("thead");if(0!==a&&i){n.startDate=r,e._genDates(!0);var o=l(e._genThead());if(i.innerHTML=o.innerHTML,a<n.num&&a>0){for(var h=a;h<n.num;h++)e._events[h].forEach((function(t){t.dateIndex-=a}));e.events.splice(0,a),e._events.splice(0,a);for(var d=0;d<a;d++)e.events.push([]),e._events.push([]);e.rerender()}else if(a<0&&a>-n.num){for(var c=0;c<n.num+a;c++)e._events[c].forEach((function(t){t.dateIndex-=a}));e.events.splice(n.num+a,-a),e._events.splice(n.num+a,-a);for(var u=0;u<-a;u++)e.events.unshift([]),e._events.unshift([]);e.rerender()}else e.clear()}}(),this},destroy:function(){this._unbind();for(var t=this.el.root.children,e=0;e<t.length;e++)this.el.root.removeChild(t[e]),e-=1;for(var n in this.el)this.el[n]=null;this.dates=[],this.events=[],this._events=[]},getEvent:function(t){if(t&&t instanceof HTMLElement){var e=this._getEventCoords(t);return this.events[e[0]][e[1]]}return null},getElem:function(t){if(t)for(var e=0;e<this.events.length;e++){var n=this.events[e].indexOf(t);if(n>-1)return this.el.dayCols[e].querySelector('[data-nr="'+n+'"]')}return null}},A=/^(?:[01][0-9]|2[0-3]):[0-5][0-9]$/,O={_posToMinute:function(t){var e=this.config,n=t.offsetTop,r=t.offsetHeight,s=60*e.dayStart+n/20*e.gap;return{startm:s,endm:s+r/20*e.gap}},_minuteToTop:function(t){var e=-1;if("number"==typeof(t=parseInt(t))&&!isNaN(t)){var n=this.config;e=(t-60*n.dayStart)/n.gap*20}return e},_quantizeH:function(t){return 20*Math.round(t/20)},_quantize:function(t){var e=this._coords.grid.top,n=this.el.scroll.scrollTop,r=t-e+n;return this._quantizeH(r)+e-n},_quantizeTop:function(t){var e=this._coords.grid.top-this.el.scroll.scrollTop;return this._quantize(t+e)-e},_getEventCoords:function(t){var e=parseInt(t.dataset.nr);return[parseInt(f(t,".events-container").dataset.index),e]},_tsItem:function(t){if(!t)return null;var e=!0;if(e&=t.date&&"Invalid Date"!==c(t.date).toString(),e&=t.start&&A.test(t.start)&&t.end&&A.test(t.end)){for(var n=this.config,r=60*n.dayStart,s=60*n.dayEnd,a=c(t.date),i=d(a),o=v(t.start),l=v(t.end),h=-1,u=0;u<this.dates.length;u++)if(i===d(this.dates[u])){h=u;break}return h>-1&&o<l&&o>=r&&l<=s?Object.assign({},t,{parsedDate:a,ymd:i,startm:o,endm:l,dateIndex:h}):null}return null},_toDateIndex:function(e){var n=this.config;if("number"==typeof e)return e<n.num&&e>-1?e:-1;if(!e)return-1;if("string"==typeof e){var r=c(e);if("Invalid Date"!==r.toString()){for(var s=-1,a=0;a<this.dates.length;a++)if(d(r)===d(this.dates[a])){s=a;break}return s}return-1}if("object"===t(e)&&e instanceof Date&&"Invalid Date"!==e.toString()){for(var i=-1,o=0;o<this.dates.length;o++)if(d(e)===d(this.dates[o])){i=o;break}return i}return-1},_toDateIndexList:function(t){var e=this,n=this.config,r=[];if(void 0===t)for(var s=0;s<n.num;s++)r.push(s);else if(Array.isArray(t)){t.map((function(t){return e._toDateIndex(t)})).forEach((function(t){-1===r.indexOf(t)&&r.push(t)}))}else{var a=this._toDateIndex(t);a>-1&&r.push(a)}return r}},q=null,j={startY:0,startX:0,yArr:[],xArr:[],timestamp:Date.now()},k=null,H=null,Y=null,z=0,B=0,V=!1,G=null,X=[],P={top:-1/0,right:1/0,bottom:1/0,left:-1/0},R=(r={h:null,v:null},s={h:0,v:0},{set:function(t,e){var n=this.el.scroll;s[t]=e,0===e?i.call(this,t):r[t]||(r[t]=setInterval((function(){"h"===t?n.scrollLeft+=s[t]:n.scrollTop+=s[t]}),16))},reset:i=function(t){var e=[];t?e.push(t):e=["h","v"];var n={h:this.el.scroll.scrollLeft-a.h,v:this.el.scroll.scrollTop-a.v};return e.forEach((function(t){clearInterval(r[t]),r[t]=null,s[t]=0})),o.call(this,t),n},scrolling:function(t){return 0!==s[t]},record:o=function(t){t&&"h"!==t||(a.h=this.el.scroll.scrollLeft),t&&"v"!==t||(a.v=this.el.scroll.scrollTop)},initScroll:a={h:0,v:0}}),F=function(){j.startY=0,j.yArr=[],j.startX=0,j.xArr=[],j.timestamp=Date.now(),clearTimeout(k),k=null,H=null,Y=null,G=null,V=!1,z=0,B=0,P={top:-1/0,right:1/0,bottom:1/0,left:-1/0}},K=function(t){return/mouse/.test(t.type)?{x:t.clientX,y:t.clientY}:{x:t.touches[0].clientX,y:t.touches[0].clientY}},W=function(t){t.stopImmediatePropagation()},J={touchstart:function(t){var r=[[".event-bar",function(t,e){e.style.opacity=1,Y=f(e,".event");var n=b(Y);z=n.height,B=n.top,P.top=this._coords.grid.top,P.bottom=this._coords.scroll.top+b(this.el.scroll).height,Y.removeEventListener("click",W)}],[".event",function(t,r){var s=this.el.root,i=this.el.scroll,o=b(Y=r);B=o.top,z=o.height,e=x(r,i),X=[].map.call(this.el.dayCols,(function(t){return x(t,i).left})),n=-1,R.record.call(this);var l=this._coords.scroll,h=E(r),d=b(i),c=b(q);P={top:a.y-h.top+l.top+b(s.querySelector("thead")).height,right:l.left+d.width-(c.width-(a.x-h.left)),bottom:l.top+d.height-(c.height-(a.y-h.top)),left:a.x-h.left+l.left+b(s.querySelector(".time-line")).width},q.removeEventListener("click",W)}],[".events-col",function(t,e){if(e===t.target){var n=i-this._coords.grid.top+this.el.scroll.scrollTop;H=l({tagName:"DIV",className:"event drawing",style:{top:n+"px"}}),e.appendChild(H)}else"event-bar"!==t.target.className&&e.contains(t.target)&&t.stopPropagation()}]],s=this.config,a=K(t),i=a.y;s.quantizing^t.shiftKey&&(i=this._quantize(i)),j.timestamp=Date.now(),j.startY=a.y,j.yArr.push(i);var o=a.x;j.startX=o,j.xArr.push(o),document.addEventListener("mousemove",this._handlers.touchmove,{passive:!1}),document.addEventListener("touchmove",this._handlers.touchmove,{passive:!1}),document.addEventListener("mouseup",this._handlers.touchend),document.addEventListener("touchend",this._handlers.touchend);for(var h=0;h<r.length;h++){var d=r[h][0],c=r[h][1].bind(this),u=p(t,d);if(u){q=u,this.el.root.style.userSelect="none",c(t,u);break}}},touchmove:function(t){var r=this.config,s=K(t),a=s.y,i=j.startY,o=r.quantizing^t.shiftKey;o&&(a=this._quantize(a),i=this._quantize(i)),j.yArr.push(a);var l=s.x,h=j.startX;j.xArr.push(l);var d=a-i,c=l-h;if(q)if("events-col"===q.className&&H&&d>0)t.preventDefault(),H.style.height=d+"px";else if("event-bar"===q.className&&Y){if(t.preventDefault(),Math.abs(d)>=r.stretchThreshold/r.gap*20||V){var u;if(V||Y.addEventListener("click",W),V=!0,s.y>=P.top&&s.y<=P.bottom)R.scrolling("v")&&R.reset.call(this,"v"),u=a-this._coords.grid.top-B+this.el.scroll.scrollTop,o||(u=z+d);else s.y<P.top&&R.set.call(this,"v",s.y-P.top),s.y>P.bottom&&R.set.call(this,"v",s.y-P.bottom);u>-.1&&B+u<=60*(r.dayEnd-r.dayStart)/r.gap*20&&(Y.style.height=Math.max(u,0)+"px",Math.round(u)>=r.createThreshold/r.gap*20?Y.classList.remove("drawing"):Y.classList.add("drawing"))}}else if(q.classList.contains("event")&&Y){t.preventDefault();var v=this.el.root,p=this.el.scroll;if(Math.abs(c)>40){var m=e.top-p.scrollTop,g=e.left-p.scrollLeft;if(G||(G=q.cloneNode(!0),Object.assign(G.style,{cursor:"move",position:"fixed",top:m+"px",left:g+"px",width:q.offsetWidth+"px",opacity:.5}),v.appendChild(G)),s.x>P.left&&s.x<P.right){var y=g+c;if(R.scrolling("h")){var _=R.reset.call(this,"h").h;j.startX-=_,y+=_}G.style.left=y+"px"}else s.x<P.left&&R.set.call(this,"h",s.x-P.left),s.x>P.right&&R.set.call(this,"h",s.x-P.right);if(s.y>P.top&&s.y<P.bottom){var E=(o?this._quantize(m):m)+d;if(R.scrolling("v")){var x=R.reset.call(this,"v").v;j.startY-=x,E+=x}G.style.top=E+"px"}else s.y<P.top&&R.set.call(this,"v",s.y-P.top),s.y>P.bottom&&R.set.call(this,"v",s.y-P.bottom);n=-1;for(var b=parseInt(f(q,".events-container").dataset.index),C=X.length-1;C>=0;C--)if(X[C]<l+p.scrollLeft){C!==b&&(n=C);break}[].forEach.call(this.el.dayCols,(function(t,e){e===n?t.classList.add("drop-target"):t.classList.remove("drop-target")})),n>-1&&this.el.dayCols[n].classList.add("drop-target")}else if([].forEach.call(this.el.dayCols,(function(t){t.classList.remove("drop-target")})),G&&(this.el.root.removeChild(G),G=null),Math.abs(d)>=r.moveYThreshold/r.gap*20||V)if(V||q.addEventListener("click",W),V=!0,q.style.cursor="move",s.y>P.top&&s.y<P.bottom)if(Object.assign(q.style,{position:"",left:"",width:""}),o){var T=this._quantizeTop(B)+d;if(R.scrolling("v")){var N=R.reset.call(this,"v").v;j.startY-=N,T+=N}T>=0&&T+z<=60*(r.dayEnd-r.dayStart)/r.gap*20&&(q.style.top=T+"px")}else q.style.top=B+d+"px";else{var D=e.top-R.initScroll.v,I=e.left-R.initScroll.h;Object.assign(q.style,{position:"fixed",left:I+"px",width:q.offsetWidth+"px"}),s.y<P.top&&(R.set.call(this,"v",s.y-P.top),q.style.top=P.top-(j.startY-D)+"px"),s.y>P.bottom&&(R.set.call(this,"v",s.y-P.bottom),q.style.top=P.bottom-(j.startY-D)+"px")}}},touchend:function(t){if(this.el.root.style.userSelect="",q){var e=this.config,r=e.quantizing^t.shiftKey,s=j.yArr[j.yArr.length-1],a=j.startY;r&&(a=this._quantize(a));var i=s-a;if("events-col"===q.className&&H){var o=this._posToMinute(H);if(q.removeChild(H),i/20*e.gap>=e.createThreshold){var l=parseInt(q.parentElement.dataset.index),h={date:d(this.dates[l]),start:u(o.startm),end:u(o.endm)};C(this.el.root,I,{item:h}),(!0===e.directChange||N(e.directChange,I))&&this.addEvent(h)}F()}else if("event-bar"===q.className&&Y){if(q.style.opacity="",Y.classList.remove("drawing"),Math.abs(Y.offsetHeight-z)>0){var c=this._posToMinute(Y),v=this._getEventCoords(Y),f=this.events[v[0]][v[1]],p={type:"end",date:f.date,start:f.start,end:u(c.endm)};Y.offsetHeight>=e.createThreshold/e.gap*20?(Y.style.height=z+"px",C(this.el.root,L,{item:f,coords:v,mod:p}),(!0===e.directChange||N(e.directChange,[L,"end"]))&&(f.end=p.end,this.updateEvent(v,f))):(Y.style.height=z+"px",C(this.el.root,S,{item:f,coords:v}),(!0===e.directChange||N(e.directChange,S))&&this.deleteEvent(v))}else Y.style.height=z+"px";F(),R.reset.call(this)}else if(q.classList.contains("event")){if(G&&Y){if(n>-1){var m=Math.round(parseFloat(G.style.top)+this.el.scroll.scrollTop-this._coords.grid.top);m=Math.max(m,0),m=Math.min(m,60*(e.dayEnd-e.dayStart)/e.gap*20-z),r&&(m=this._quantizeTop(m));var g=60*e.dayStart+m/20*e.gap,y=g+Math.round(z/20*e.gap),_=this._getEventCoords(Y),E=this.events[_[0]][_[1]],x=g==this._events[_[0]][_[1]].startm?"date":"datetime",T={type:x,date:d(this.dates[n]),start:u(g),end:u(y)};C(this.el.root,L,{item:E,coords:_,mod:T}),(!0===e.directChange||N(e.directChange,[L,x]))&&(Object.assign(E,{date:T.date,start:T.start,end:T.end}),this.updateEvent(_,E))}Object.assign(Y.style,{top:B+"px",height:z}),this.el.root.removeChild(G),[].forEach.call(this.el.dayCols,(function(t){t.classList.remove("drop-target")}))}else if(Y){var D=b(Y);if(Math.abs(D.top-B)>0){if("fixed"===Y.style.position){var w,M=R.reset.call(this,"v").v;Object.assign(Y.style,{position:"",left:"",width:""}),s<=P.top?w=B-(j.startY-P.top)+M:s>=P.bottom&&(w=B+(P.bottom-j.startY)+M),w=Math.max(w,0),w=Math.min(w,60*(e.dayEnd-e.dayStart)/e.gap*20-z),r&&(w=this._quantizeTop(w)),Y.style.top=w+"px"}var A=this._posToMinute(Y),O=this._getEventCoords(Y),k=this.events[O[0]][O[1]],V={type:"start",date:k.date,start:u(A.startm),end:u(A.endm)};Object.assign(Y.style,{top:B+"px",height:z+"px"}),C(this.el.root,L,{item:k,coords:O,mod:V}),(!0===e.directChange||N(e.directChange,[L,"start"]))&&(k.start=V.start,k.end=V.end,this.updateEvent(O,k))}}q.style.cursor="",F(),R.reset.call(this)}document.removeEventListener("mousemove",this._handlers.touchmove,{passive:!1}),document.removeEventListener("touchmove",this._handlers.touchmove,{passive:!1}),document.removeEventListener("mouseup",this._handlers.touchend),document.removeEventListener("touchend",this._handlers.touchend)}},keydown:function(t){"Escape"!==t.key&&"Esc"!==t.key||(H&&H.parentElement.removeChild(H),Y&&Object.assign(Y.style,{top:B+"px",height:z+"px",position:"",width:"",left:""}),G&&(G.parentElement.removeChild(G),[].forEach.call(this.el.dayCols,(function(t){t.classList.remove("drop-target")}))),F(),R.reset.call(this),document.removeEventListener("mousemove",this._handlers.touchmove,{passive:!1}),document.removeEventListener("touchmove",this._handlers.touchmove,{passive:!1}))},click:function(t){var e=!1;console.log(e);for(var n=t.target;n&&!n.matches(".event");){if(n===t.currentTarget){n=null;break}n.matches(".event-bar")&&(e=!0),n=n.parentElement}e&&t.stopImmediatePropagation()}},$={_bind:function(){for(var t in J)this._handlers[t]=J[t].bind(this);this.el.root.addEventListener("mousedown",this._handlers.touchstart),this.el.root.addEventListener("touchstart",this._handlers.touchstart),document.addEventListener("keydown",this._handlers.keydown)},_unbind:function(){this.el.root.removeEventListener("mousedown",this._handlers.touchstart),this.el.root.removeEventListener("touchstart",this._handlers.touchstart),document.removeEventListener("keydown",this._handlers.keydown)}},Q=function(t,e){var n;if(!(n="string"==typeof t?document.querySelector(t):t)||"TABLE"!==n.tagName)throw new TypeError("el must be a <TABLE> element or a valid selector");this.config=Object.assign({},D,e),this.dates=[],this.el={root:n,dayCols:n.getElementsByClassName("day-col"),dayGrids:n.getElementsByClassName("day-grid"),eventsContainers:n.getElementsByClassName("events-container"),scroll:_(n)},this.events=[],this._events=[],this._handlers={},this._init(),this._coords={grid:x(this.el.dayGrids[0]),scroll:x(this.el.scroll)}};return Q.prototype._init=function(){this._genDates(),this._renderOuter(),this._renderInner(),this._bind()},Object.assign(Q.prototype,w,M,O,$),Q}));
